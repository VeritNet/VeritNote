<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeritNote</title>

    <script>
        (function() {
        const ua = navigator.userAgent.toLowerCase();
        const html = document.documentElement;
        if (ua.includes('android')) {
        window.currentOS = 'android';
        html.className += ' os-android';
        } else {
        window.currentOS = 'windows';
        html.className += ' os-windows';
        }
        })();
    </script>

    <!-- Vendor -->
    <link rel="stylesheet" href="vendor/highlight/theme.css">

    <!-- 1. Load global theme variables first -->
    <link rel="stylesheet" href="components/main/theme.css">

    <!-- 2. Load component-specific styles -->
    <link rel="stylesheet" href="components/main/ConfigModal.css">

    <link rel="stylesheet" href="components/main/main.css">

    <link rel="stylesheet" href="page-theme.css">
    <link rel="stylesheet" href="components/page-editor/page-editor.css">

    <!-- 3. Load block-specific styles -->
    <!-- Shared -->
    <link rel="stylesheet" href="components/blocks/shared/block-core.css">
    <!-- Individual -->
    <link rel="stylesheet" href="components/blocks/callout/callout.css">
    <link rel="stylesheet" href="components/blocks/code/code.css">
    <link rel="stylesheet" href="components/blocks/columns/columns.css">
    <link rel="stylesheet" href="components/blocks/heading/heading.css">
    <link rel="stylesheet" href="components/blocks/image/image.css">
    <link rel="stylesheet" href="components/blocks/link-button/link-button.css">
    <link rel="stylesheet" href="components/blocks/list-items/list-item-shared.css">
    <link rel="stylesheet" href="components/blocks/quote/quote.css">
    <link rel="stylesheet" href="components/blocks/table/table.css">

</head>
<body>
    <!-- The main application shell will be loaded here -->
    <div id="app-root"></div>

    <!-- Scripts -->
    <!-- Note: We are not including block scripts here anymore. They will be loaded by the PageEditor -->
    <script src="components/main/default-config.js"></script>
    <script src="components/main/ipc.js"></script>
    <script src="components/main/ConfigModal.js"></script>
    <script src="components/main/global-state.js"></script>
    <script src="components/main/main.js"></script>

    <!-- Editor and Block scripts -->
    <script src="components/page-editor/HistoryManager.js"></script>
    <script src="components/page-editor/popovers.js"></script>

    <!-- Load Block Base Classes FIRST -->
    <script src="components/blocks/Block.js"></script>
    <script src="components/blocks/TextBlock.js"></script>
    <script src="components/blocks/ContainerBlock.js"></script>

    <!-- Load All Concrete Block Implementations -->
    <script src="components/blocks/paragraph/ParagraphBlock.js"></script>
    <script src="components/blocks/heading/Heading1Block.js"></script>
    <script src="components/blocks/heading/Heading2Block.js"></script>
    <script src="components/blocks/image/ImageBlock.js"></script>
    <script src="components/blocks/link-button/LinkButtonBlock.js"></script>
    <script src="components/blocks/callout/CalloutBlock.js"></script>
    <script src="components/blocks/columns/ColumnBlock.js"></script>
    <script src="components/blocks/columns/ColumnsBlock.js"></script>
    <script src="components/blocks/code/CodeBlock.js"></script>
    <script src="components/blocks/list-items/BulletedListItemBlock.js"></script>
    <script src="components/blocks/list-items/TodoListItemBlock.js"></script>
    <script src="components/blocks/list-items/NumberedListItemBlock.js"></script>
    <script src="components/blocks/list-items/ToggleListItemBlock.js"></script>
    <script src="components/blocks/quote/QuoteBlock.js"></script>
    <script src="components/blocks/table/TableBlock.js"></script>

    <!-- Load the PageEditor class itself LAST -->
    <script src="components/page-editor/page-editor.js"></script>

    <!-- Vendor Scripts -->
    <script src="vendor/highlight/highlight.min.js"></script>

    <script>
        // Main application entry point
        document.addEventListener('DOMContentLoaded', async () => {
        const appRoot = document.getElementById('app-root');

        // Fetch and inject the main HTML structure
        const response = await fetch('components/main/main.html');
        appRoot.innerHTML = await response.text();

        // After the HTML is injected, the DOM is ready for the main script.
        // We check if the initialization function exists on the window object and then call it.
        if (window.initializeMainComponent) {
        window.initializeMainComponent();
        } else {
        console.error("Main component initialization function not found!");
        }
        });
    </script>
</body>
</html>